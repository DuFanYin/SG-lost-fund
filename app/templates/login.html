<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAUZYEkqQSsEVM7rMCLqaEKoibGPiP_YJI",
            authDomain: "wad2project-db69b.firebaseapp.com",
            databaseURL: "https://wad2project-db69b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "wad2project-db69b",
            storageBucket: "wad2project-db69b.appspot.com",
            messagingSenderId: "262163048895",
            appId: "1:262163048895:web:5ab7dd89cf3bc6daaad90a",
            measurementId: "G-PKT1RMGB01"
        };
        firebase.initializeApp(firebaseConfig);

        // Handle Login
        async function logIn() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                // Sign in the user with Firebase Authentication
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                const idToken = await userCredential.user.getIdToken();

                // Send the ID token to the backend for additional verification and session creation
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + idToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('User logged in successfully:', data);
                    alert('Login successful!');
                    // Redirect to dashboard or other page
                    window.location.href = '/dash_board';
                } else {
                    const errorData = await response.json();
                    console.error('Error logging in:', errorData);
                    alert('Error logging in: ' + (errorData.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error logging in:', error);
                alert('Error logging in: ' + error.message);
            }
        }
    </script>
</head>

<body>
    <h1>Login</h1>
    <form onsubmit="event.preventDefault(); logIn();">
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit">Log In</button>
    </form>
</body>

</html>
