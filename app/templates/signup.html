<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <!-- Firebase App (Core) SDK with compat versions for older-style imports -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAUZYEkqQSsEVM7rMCLqaEKoibGPiP_YJI",
            authDomain: "wad2project-db69b.firebaseapp.com",
            databaseURL: "https://wad2project-db69b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "wad2project-db69b",
            storageBucket: "wad2project-db69b.appspot.com",
            messagingSenderId: "262163048895",
            appId: "1:262163048895:web:5ab7dd89cf3bc6daaad90a",
            measurementId: "G-PKT1RMGB01"
        };
        firebase.initializeApp(firebaseConfig);

        // Handle Sign Up
        async function signUp() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const username = document.getElementById('username').value;

            try {
                // Create user with email and password
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                const idToken = await userCredential.user.getIdToken();

                // Send the ID token to the backend
                const response = await fetch('/signup', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + idToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, email })
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('User registered successfully:', data);
                    alert('User registered successfully!');
                } else {
                    const errorData = await response.json();
                    console.error('Error registering user:', errorData);
                    alert('Error registering user: ' + (errorData.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error signing up:', error);
                alert('Error signing up: ' + error.message);
            }
        }
    </script>
</head>

<body>
    <h1>Sign Up</h1>
    <form onsubmit="event.preventDefault(); signUp();">
        <input type="text" id="username" placeholder="Username" required>
        <input type="email" id="email" placeholder="Email" required>
        <input type="password" id="password" placeholder="Password" required>
        <button type="submit">Sign Up</button>
    </form>
</body>

</html>
